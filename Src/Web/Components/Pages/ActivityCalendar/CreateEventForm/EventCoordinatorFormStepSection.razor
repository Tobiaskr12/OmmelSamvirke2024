@using DomainModules.Events.Entities
@using FluentValidation
@using Web.Components.Shared.MultiStepForm

@inherits AbstractStepSection<Event>

<MudAutocomplete
    T="string"
    Label="Navn"
    Variant="Variant.Outlined"
    Dense="true"
    CoerceText="true"
    Clearable="true"
    Required="true"
    ResetValueOnEmptyText="false"
    @bind-value="Entity.EventCoordinator.Name"
    For="@(() => Entity.EventCoordinator.Name)"
    SearchFunc="SearchCoordinators" />

<MudTextField
    T="string"
    Label="E-mailadresse"
    Variant="Variant.Outlined"
    @bind-value="Entity.EventCoordinator.EmailAddress"
    For="@(() => Entity.EventCoordinator.EmailAddress)"
    OnlyValidateIfDirty="true" />

<MudTextField
    T="string"
    Label="Telefonnummer"
    Variant="Variant.Outlined"
    @bind-Value="Entity.EventCoordinator.PhoneNumber"
    For="@(() => Entity.EventCoordinator.PhoneNumber)"
    OnlyValidateIfDirty="true" />

<MudText Typo="Typo.body1">
    (E-mailadresse eller telefonnummer skal udfyldes)
</MudText>

@code {
    [CascadingParameter] private MudForm? Form { get; set; }
    
    private async Task OnCoordinatorNameChanged(string newName)
    {
        Entity.EventCoordinator.Name = newName;
        if (Form != null) await Form.Validate();
    }
    
    // Dummy in-memory data; your real code will fetch this
    private List<EventCoordinator> _allCoordinators =
    [
        new() { Name = "Anna Hansen", EmailAddress = "anna@example.com", PhoneNumber = "+45 12345678" },
        new() { Name = "Peter SÃ¸rensen", EmailAddress = "peter@example.com", PhoneNumber = "+45 87654321" }
    ];

    private Task<IEnumerable<string>> SearchCoordinators(string value, CancellationToken cancellationToken)
    {
        if (string.IsNullOrWhiteSpace(value))
            return Task.FromResult(_allCoordinators.Select(x => x.Name));
        
        return Task.FromResult(_allCoordinators
                               .Where(x => x.Name.Contains(value, StringComparison.InvariantCultureIgnoreCase))
                               .Select(x => x.Name));
    }

    protected override IValidator<Event>? Validator { get; set; } = null;
}
